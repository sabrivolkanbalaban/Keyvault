{% extends "base.html" %}

{% block title %}My Licenses - KeyVault{% endblock %}

{% block content %}
<h4 class="fw-bold mb-4">My Licenses</h4>

{% if assignments %}
<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Vendor</th>
                    <th>Type</th>
                    <th>Assigned Date</th>
                    <th>Machine</th>
                    <th>Expiration</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for a in assignments %}
                <tr>
                    <td>
                        <a href="{{ url_for('licenses.detail', license_id=a.license.id) }}" class="text-decoration-none fw-semibold">
                            {{ a.license.name }}
                        </a>
                        {% if a.license.version %}
                        <small class="text-muted">v{{ a.license.version }}</small>
                        {% endif %}
                    </td>
                    <td>{{ a.license.vendor or '-' }}</td>
                    <td>
                        <span class="badge bg-{{ 'primary' if a.license.license_type == 'perpetual' else 'info' if a.license.license_type == 'subscription' else 'warning text-dark' if a.license.license_type == 'trial' else 'secondary' }}">
                            {{ a.license.license_type }}
                        </span>
                    </td>
                    <td>
                        <small>{{ a.assigned_date.strftime('%Y-%m-%d') if a.assigned_date else '-' }}</small>
                    </td>
                    <td>{{ a.machine_name or '-' }}</td>
                    <td>
                        {% if a.license.expiration_date %}
                        <small class="{{ 'text-danger fw-semibold' if a.license.is_expired else 'text-warning' if a.license.is_expiring_soon else '' }}">
                            {{ a.license.expiration_date.strftime('%Y-%m-%d') }}
                        </small>
                        {% else %}
                        <small class="text-muted">No expiry</small>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge bg-{{ 'success' if a.license.status_label == 'active' else 'danger' if a.license.status_label == 'expired' else 'warning text-dark' if a.license.status_label == 'expiring_soon' else 'secondary' }}">
                            {{ a.license.status_label | replace('_', ' ') | title }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="text-center text-muted py-5">
    <i class="bi bi-patch-check" style="font-size: 3rem;"></i>
    <p class="mt-3">No licenses assigned to you.</p>
</div>
{% endif %}
{% endblock %}
