{% extends "base.html" %}

{% block title %}{{ app.name }} - KeyVault{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{{ url_for('applications.list_applications') }}" class="text-decoration-none text-muted">
        <i class="bi bi-arrow-left me-1"></i>Back to Applications
    </a>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="fw-bold mb-1">{{ app.name }}</h4>
        <span class="badge bg-{{ app.status_badge_class }} me-1">{{ app.status | title }}</span>
        {% if app.criticality %}
        <span class="badge bg-{{ app.criticality_badge_class }}">{{ app.criticality }}</span>
        {% endif %}
    </div>
    {% if current_user.is_admin() %}
    <div class="d-flex gap-2">
        <a href="{{ url_for('applications.edit', app_id=app.id) }}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-pencil me-1"></i>Edit
        </a>
        <form method="post" action="{{ url_for('applications.delete', app_id=app.id) }}"
              onsubmit="return confirm('Are you sure you want to delete this application?');" class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash me-1"></i>Delete
            </button>
        </form>
    </div>
    {% endif %}
</div>

<div class="row g-4">
    <!-- Main Content -->
    <div class="col-md-8">
        <!-- Basic Information -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-semibold">Basic Information</h6>
            </div>
            <div class="card-body">
                {% if app.description %}
                <div class="mb-3">
                    <small class="text-muted d-block">Description</small>
                    <p class="mb-0 mt-1">{{ app.description }}</p>
                </div>
                {% endif %}

                {% if app.url %}
                <div class="mb-3">
                    <small class="text-muted d-block">URL</small>
                    <a href="{{ app.url }}" target="_blank" class="text-decoration-none">
                        {{ app.url }} <i class="bi bi-box-arrow-up-right small"></i>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Technical Details -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-semibold">Technical Details</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Operating System</small>
                        <span>{{ app.operating_system or '-' }}</span>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Platform</small>
                        {% if app.platform %}
                        <span class="badge bg-info mt-1">{{ app.platform }}</span>
                        {% else %}
                        <span>-</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Database</small>
                        <span>{{ app.database_type or '-' }}</span>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Version</small>
                        <span>{{ app.app_version or '-' }}</span>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Deployment Type</small>
                        {% if app.deployment_type %}
                        <span class="badge bg-dark mt-1">{{ app.deployment_type }}</span>
                        {% else %}
                        <span>-</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Management -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-semibold">Management</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Responsible Person</small>
                        <span>{{ app.responsible_person or '-' }}</span>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Department</small>
                        <span>{{ app.department or '-' }}</span>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">SLA Level</small>
                        {% if app.sla_level %}
                        <span class="badge bg-{{ app.sla_badge_class }} mt-1">{{ app.sla_level }}</span>
                        {% else %}
                        <span>-</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Criticality</small>
                        {% if app.criticality %}
                        <span class="badge bg-{{ app.criticality_badge_class }} mt-1">{{ app.criticality }}</span>
                        {% else %}
                        <span>-</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Maintenance Date</small>
                        <span>{{ app.maintenance_date.strftime('%Y-%m-%d') if app.maintenance_date else '-' }}</span>
                    </div>
                </div>

                {% if app.notes %}
                <div class="mt-3">
                    <small class="text-muted d-block">Notes</small>
                    <p class="mb-0 mt-1">{{ app.notes }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
        <!-- Server Details -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-semibold">Server Details</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <small class="text-muted d-block">Server Name</small>
                    <span class="fw-semibold">{{ app.server_name or '-' }}</span>
                </div>
                <div class="mb-2">
                    <small class="text-muted d-block">IP Address</small>
                    {% if app.ip_address %}
                    <code>{{ app.ip_address }}</code>
                    {% else %}
                    <span>-</span>
                    {% endif %}
                </div>
                <div class="mb-2">
                    <small class="text-muted d-block">Port</small>
                    {% if app.port %}
                    <code>{{ app.port }}</code>
                    {% else %}
                    <span>-</span>
                    {% endif %}
                </div>
                {% if app.url %}
                <div class="mb-2">
                    <small class="text-muted d-block">URL</small>
                    <a href="{{ app.url }}" target="_blank" class="text-decoration-none small">
                        {{ app.url }} <i class="bi bi-box-arrow-up-right"></i>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Metadata -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-semibold">Metadata</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <small class="text-muted d-block">Created By</small>
                    <span>{{ app.created_by.full_name if app.created_by else '-' }}</span>
                </div>
                <div class="mb-2">
                    <small class="text-muted d-block">Created</small>
                    <span>{{ app.created_at.strftime('%Y-%m-%d %H:%M') if app.created_at else '-' }}</span>
                </div>
                {% if app.updated_at %}
                <div class="mb-2">
                    <small class="text-muted d-block">Last Updated</small>
                    <span>{{ app.updated_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
